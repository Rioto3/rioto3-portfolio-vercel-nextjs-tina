---
title: a
excerpt: |
  a
author: content/authors/Rioto3.md
---

# 第2部：技術的検証と方法論

## 7. gBizINFO APIの概要と活用法

### API概要と基本構造

gBizINFO APIは、経済産業省が提供する法人情報データベースのRESTfulインターフェースです。企業・団体の基本情報から補助金受給、特許、調達情報など多岐にわたるデータにプログラムからアクセスできます。

APIは以下のような基本構造を持っています：

* **ベースURL**: `https://info.gbiz.go.jp/hojin`
* **認証方法**: HTTPヘッダ `X-hojinInfo-api-token` による認証
* **レスポンス形式**: JSON形式
* **利用制限**: 1日あたり10,000リクエスト

### APIトークンの取得方法

APIを利用するには、専用のトークンが必要です。取得方法は以下の通りです：

1. [gBizINFO API利用申請ページ](https://info.gbiz.go.jp/api/api_registration/form)にアクセス
2. 必要事項を入力（組織名、利用目的など）
3. 申請後、メールでAPIトークンが送付される

なお、公式ドキュメントでは動作確認用として `DTcLxzo1lZaUYaQPVdSRxdS4MzlXNCs4` というトークンも提供されていますが、本格的な利用には専用トークンの取得が推奨されます。

### 主要エンドポイントの解説

分析に特に重要な2つのエンドポイントについて解説します：

1. **法人検索エンドポイント** (`/v1/hojin`)
   * 様々な条件で法人を検索
   * 地域、業種、資本金など複数の検索条件をサポート
   * ページング機能あり（1ページあたり最大5000件、最大10ページ）
2. **法人別補助金情報取得エンドポイント** (`/v1/hojin/{corporate_number}/subsidy`)
   * 特定の法人番号に紐づく補助金情報を取得
   * 各補助金の金額、交付日、省庁などの詳細情報を含む

エンドポイント呼び出しの基本形式は以下の通りです：

```python
# 法人検索の例（宮城県の補助金情報を持つ法人）
GET /v1/hojin?prefecture=04&exist_flg=true&source=4

# 特定法人の補助金情報取得の例
GET /v1/hojin/1000020042021/subsidy
```

### 実行環境と再現性

本研究では、Google Colabを用いた再現可能な分析環境を構築しています。以下のリンクからノートブックにアクセスし、実際のコードを実行できます：

[gBizINFO API分析ノートブック](https://colab.research.google.com/github/Rioto3/gbizinfo-subsidy-analysis/blob/main/gbizinfo_miyagi.ipynb)

このノートブックでは、APIの呼び出しからデータベース構築、CSVファイル生成までの一連のプロセスを実装しています。APIトークンを設定するだけで、同じ分析を再現できます。

## 8. データパイプラインの構築

### 2テーブル構造の必要性

gBizINFO APIの特性上、補助金データを効率的に収集するには2段階のプロセスが必要です：

1. **法人テーブル**: まず法人の基本情報と法人番号を取得
2. **補助金テーブル**: 各法人番号に対して補助金情報を取得

この2テーブル構造が必要な理由は、APIの設計にあります。補助金情報は法人番号をキーとして取得する必要があり、一度の検索で全補助金情報を取得することはできません。

### SQLiteデータベース設計

データ量が多くなる可能性を考慮し、インメモリのDataFrameではなくSQLiteデータベースを採用しました。SQLiteは軽量でありながら、リレーショナルデータベースの利点を活かせます。

以下にテーブル設計を示します：

```python
# ここにSQLAlchemyを使用したテーブル定義コードが入ります
# 法人テーブルと補助金テーブルの定義
```

この設計の主なポイントは以下の通りです：

* **法人テーブル**: 法人番号をプライマリキーとし、基本情報を格納
* **補助金テーブル**: 各補助金情報と、法人番号への外部キー参照を持つ
* **リレーションシップ**: 両テーブル間に1対多の関係を定義

### データ収集プロセス

データ収集は以下の順序で行います：

1. **法人データの収集**:
   * 宮城県（`prefecture=04`）の補助金情報を持つ法人を検索
   * ページングを利用して最大限のデータを取得
   * 取得した法人情報をデータベースに保存

```python
# ここに法人データ収集のコードが入ります
```

1. **補助金データの収集**:
   * 法人テーブルから法人番号のリストを取得
   * 各法人番号に対して補助金情報を取得
   * 取得した補助金情報をデータベースに保存

```python
# ここに補助金データ収集のコードが入ります
```

### エラーハンドリングと増分更新

長時間のデータ収集プロセスを安定させるため、以下の工夫を実装しています：

* **エラーハンドリング**: API接続エラーやタイムアウトに対応するtry-except構造
* **増分更新**: すでにデータベースに存在する法人はスキップ
* **定期的コミット**: 一定数のレコード処理ごとにデータベースへコミット
* **進捗表示**: 現在の処理状況を表示し、長時間処理の進捗を確認可能

これらの工夫により、途中で処理が中断しても再開可能な堅牢なデータ収集プロセスを実現しています。

## 9. データ処理と分析準備

### データクレンジングのアプローチ

APIから取得したデータには、以下のような課題が含まれることがあります：

* 補助金金額が文字列形式（「100,000円」など）
* 日付形式の不統一
* 省庁名や補助金名称の表記ゆれ
* 欠損値や異常値の存在

これらの課題に対処するため、以下のクレンジング処理を実装しています：

```python
# ここにデータクレンジングのコードが入ります
```

主なクレンジング内容：

* 金額の数値変換（カンマ除去、単位削除、整数変換）
* 日付の標準形式への変換
* 表記ゆれの標準化
* 欠損値の適切な処理（0や空文字列など）

### 集計と統合

クレンジングされたデータを基に、最終的な分析データセットを作成します。主なステップは以下の通りです：

1. **補助金受給回数の集計**:
   * 法人番号ごとに補助金レコード数をカウント
   * 法人番号ごとに補助金総額を集計
2. **法人情報との結合**:
   * 集計結果と法人テーブルを法人番号で結合
   * 必要な列のみを選択

```python
# ここに集計と結合のコードが入ります
```

### 最終CSVデータセットの生成

分析の核となる最終データセットは以下の構造を持ちます：

| corporate\_number | name | location  | subsidy\_count | total\_amount |
| ----------------- | ---- | --------- | -------------- | ------------- |
| 8000020040002     | 宮城県  | 宮城県仙台市... | 2073           | 1121292325461 |
| 8000020041009     | 仙台市  | 宮城県仙台市... | 522            | 398400750588  |
| ...               | ...  | ...       | ...            | ...           |

このデータセットを作成し、CSVファイルとして出力するコードは以下の通りです：

```python
# ここにCSV出力のコードが入ります
```

このCSVファイルが、本研究の分析の出発点となります。この時点でデータ収集・処理プロセスは完了し、次のステップである分析フェーズに移行します。

### データの品質検証

生成したデータセットの品質を確保するため、以下の検証を実施しています：

* **欠損値のチェック**: 各列の欠損値数と割合の確認
* **異常値の特定**: 極端に大きい/小さい値の特定
* **重複レコードの確認**: 同一法人の重複エントリの有無
* **基本統計量の確認**: 平均、中央値、最大値、最小値などの確認

```python
# ここにデータ品質検証のコードが入ります
```

また、サンプリングによる目視確認も重要です。特に上位の補助金受給法人については、公開情報と照合して正確性を確認しています。

## 10. 生成AIへのデータ入力と分析

### 最適なCSV構造の設計

生成AIを活用した分析を効果的に行うため、CSVデータは以下の点を考慮して設計しています：

1. **シンプルな列構造**: 必要最小限の列のみを含める
2. **明確な命名規則**: 列名は理解しやすい英語を使用
3. **適切なソート**: 補助金受給回数/金額でソートし、特徴的なパターンを把握しやすく
4. **管理可能なサイズ**: 必要に応じて上位N件に絞る

最終的なCSVは以下のような特徴を持っています：

* 行数: 約2,000件（宮城県の補助金受給法人）
* 列数: 5列（法人番号、法人名、所在地、受給回数、総額）
* サイズ: 約200KB（生成AIの入力制限内）

### プロンプトエンジニアリング手法

CSVデータを生成AIに入力する際、効果的な分析を促すプロンプト設計が重要です。以下のようなプロンプト構造を推奨します：

```
以下の宮城県補助金データを分析し、特徴的なパターンを特定してください。
特に注目すべき点：
1. 補助金受給回数の分布の特徴
2. 特定の業種/組織タイプに偏りがあるか
3. 統計的に異常と思われる受給パターン
4. 公的機関と民間企業の受給傾向の違い

CSVデータ:
corporate_number,name,location,subsidy_count,total_amount
8000020040002,宮城県,宮城県仙台市...,2073,1121292325461
...（以下データ）
```

このプロンプトは、データの概要と分析の視点を明確に指定することで、より価値のある洞察を引き出します。

### データに基づく問題指摘と検証

生成AIからの分析結果に対しては、以下のような検証プロセスを実施することが重要です：

1. **ファクトチェック**:
   * AIが指摘した特定の法人の補助金受給回数が正確か確認
   * 総額や平均値などの計算が正しいか検証
2. **追加データ検索**:
   * 特に注目すべき法人について追加情報を収集
   * 公式ウェブサイトや報道情報との照合
3. **カテゴリ分析の検証**:
   * AIが「農業法人が多い」などと指摘した場合、実際の比率を計算
   * 例: `df[df['name'].str.contains('農事組合法人')].count() / len(df)`

```python
# ここにデータ検証のコードが入ります
```

### 分析結果のフィードバックループ

最初の分析結果をもとに、より詳細な分析を行うフィードバックループも重要です：

1. **初期分析**: 全体的なパターンの把握
2. **焦点の絞り込み**: 特に興味深いセグメント（例：農業法人）の特定
3. **詳細分析**: 特定セグメントに絞った追加プロンプト
4. **結果の統合**: 複数の分析結果の統合と包括的な理解

例えば、最初の分析で農業法人の受給回数が多いことが判明した場合、以下のような追加プロンプトが効果的です：

```
前回の分析で農業法人（農事組合法人）の補助金受給回数が多い傾向が指摘されました。
以下のデータから、農業法人の補助金受給パターンについてより詳細に分析してください：
1. 農業法人と他の法人種別の受給回数の統計的比較
2. 農業政策との関連性
3. 地域による農業法人の受給パターンの違い

（農業法人に絞ったCSVデータ）
```

このようなフィードバックループにより、データから最大限の洞察を引き出すことができます。

## まとめ：技術的検証の意義

本パートでは、gBizINFO APIを活用した補助金データ分析の技術的側面を詳述しました。このアプローチの最大の意義は以下の点にあります：

1. **再現可能性**: 誰でも同じデータセットを作成し、独自の分析を行える
2. **客観性**: APIから直接取得した公的データを基盤とすることで、客観的な分析が可能
3. **拡張性**: 同様の手法を他の地域や時期にも適用可能
4. **効率性**: 生成AIとの連携により、専門知識がなくても深い洞察を得られる

データ収集からCSV生成までのパイプラインを構築することで、「何を分析するか」と「どう解釈するか」を分離し、より透明性の高い議論の基盤を提供できます。この手法は、補助金データだけでなく、様々な公共データの分析にも応用可能です。

最終的に生成されたCSVデータセットは、本研究の第1部で示す分析と考察の客観的基盤となります。読者はこの手法を自ら実践することで、公的資金の流れに関する独自の視点からの分析が可能になるでしょう。
